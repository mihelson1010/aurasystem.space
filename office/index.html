<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Aura Office</title>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      background:white;
      font-family:Inter, sans-serif;
      min-height:100vh;
      display:flex;
      flex-direction:column;
    }
    .toolbar {
      display:flex;
      justify-content:center;
      padding:14px;
      background:#f9f9f9;
      border-bottom:1px solid #eee;
      gap:8px;
      flex-wrap:wrap;
    }
    .tool-btn {
      padding:10px 16px;
      border-radius:20px;
      font-weight:bold;
      color:white;
      border:none;
      cursor:pointer;
      box-shadow:0 4px 10px rgba(0,0,0,0.1);
    }
    .tool-btn:hover {
      transform:translateY(-2px);
      box-shadow:0 6px 14px rgba(0,0,0,0.15);
    }
    .btn-calc      { background:linear-gradient(135deg, #3498db, #2980b6); }
    .btn-currency  { background:linear-gradient(135deg, #ff7700, #ffaa00); }
    .btn-invite    { background:linear-gradient(135deg, #9b59b6, #8e44ad); }
    .btn-excel     { background:linear-gradient(135deg, #4a90e2, #50b4ff); }
    .btn-qr        { background:linear-gradient(135deg, #2ecc71, #27ae60); }
    .btn-share     { background:linear-gradient(135deg, #e74c3c, #c0392b); }
    .btn-send-txt  { background:linear-gradient(135deg, #1abc9c, #16a085); }
    .btn-send-enc  { background:linear-gradient(135deg, #27ae60, #2ecc71); }
    .btn-print     { background:linear-gradient(135deg, #8e44ad, #9b59b6); }

    .workspace {
      flex:1;
      padding:20px;
      overflow:auto;
    }
    #editor {
      width:100%;
      min-height:100vh;
      padding:20px;
      font-size:16px;
      line-height:1.6;
      outline:none;
      caret-color:#000;
      background:white;
    }

    /* –ü–ê–ù–ï–õ–ò */
    .panel {
      position: fixed;
      top: 80px;
      left: 20px;
      width: 360px;
      max-height: 80vh;
      overflow-y: auto;
      background: #0d0d1a;
      border-radius: 16px;
      padding: 20px;
      box-shadow: 0 12px 30px rgba(0,0,0,0.4);
      color: #fff;
      z-index: 100;
      display: none;
    }

    /* EXCEL ‚Äî –ü–û–õ–ù–´–ô –≠–ö–†–ê–ù */
    #excel-full {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: white;
      z-index: 200;
      padding: 20px;
      box-sizing: border-box;
      overflow: auto;
    }
    #excel-full .toolbar {
      background: #f9f9f9;
      padding: 10px;
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      border-bottom: 1px solid #ddd;
      position: relative;
    }
    #excel-full .close-btn {
      background: #e74c3c;
      color: white;
      padding: 6px 12px;
      border-radius: 8px;
      cursor: pointer;
    }
    #excel-full .lang-btn {
      position: absolute;
      right: 10px;
      top: 10px;
      background: #333;
      color: #0f0;
      padding: 4px 8px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.9rem;
    }
    #excel-full .lang-menu {
      position: absolute;
      right: 10px;
      top: 40px;
      background: #222;
      border: 1px solid #444;
      border-radius: 8px;
      padding: 8px;
      display: none;
      z-index: 1000;
    }
    #excel-full .lang-menu a {
      display: block;
      padding: 4px 8px;
      color: #fff;
      text-decoration: none;
      font-size: 0.9rem;
    }
    #excel-full .lang-menu a:hover {
      background: #444;
    }

    #handsontable-container {
      height: calc(100vh - 140px);
      margin-top: 10px;
    }

    /* SHARE ‚Äî —Å–≤–µ—Ç–ª—ã–π —Ñ–æ–Ω */
    .share-links {
      background: #fff;
      border: 1px solid #ddd;
      border-radius: 16px;
      padding: 20px;
      text-align: center;
      margin: 20px auto;
      max-width: 400px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }
    .share-links h3 {
      color: #333;
      margin-bottom: 16px;
    }
    .share-links a {
      display: inline-block;
      margin: 8px;
      font-size: 28px;
      text-decoration: none;
      color: #333;
    }
    .share-links a:hover {
      opacity: 0.8;
      transform: scale(1.1);
    }
    .share-links a.x { color: #000; }
    .share-links a.telegram { color: #0088cc; }
    .share-links a.whatsapp { color: #25d366; }
    .share-links a.email { color: #ff6b6b; }

    /* QR */
    .qr-output {
      background: #fff;
      border: 1px solid #ddd;
      border-radius: 16px;
      padding: 20px;
      text-align: center;
      margin: 20px auto;
      max-width: 400px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }
    .qr-output h3 {
      color: #333;
      margin-bottom: 16px;
    }
    #qrcode canvas {
      margin: 10px auto;
      display: block;
      background: white;
      padding: 10px;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }

    .footer {
      position:fixed;
      bottom:12px;
      right:16px;
      font-size:0.8rem;
      color:#888;
    }
  </style>

  <!-- Handsontable -->
  <link href="https://cdn.jsdelivr.net/npm/handsontable@13.3.0/dist/handsontable.full.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/handsontable@13.3.0/dist/handsontable.full.min.js"></script>

  <!-- formulajs –¥–ª—è Excel-—Ñ–æ—Ä–º—É–ª -->
  <script src="https://cdn.jsdelivr.net/npm/formulajs@4.4.0/lib/formula.js"></script>

  <!-- SheetJS –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞/—ç–∫—Å–ø–æ—Ä—Ç–∞ .xlsx -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/qrious@4.0.0/dist/qrious.min.js"></script>
</head>
<body>

<div class="toolbar">
  <button class="tool-btn btn-calc" onclick="showPanel('calc')">üßÆ Calc</button>
  <button class="tool-btn btn-currency" onclick="showPanel('currency'); loadRates()">üí± Forex</button>
  <button class="tool-btn btn-invite" onclick="inviteCollab()">‚úâÔ∏è Invite</button>
  <button class="tool-btn btn-excel" onclick="showExcelFull()">üìä Excel</button>
  <button class="tool-btn btn-qr" onclick="showPanel('qr'); generateQR()">üì± QR</button>
  <button class="tool-btn btn-share" onclick="showPanel('share'); showShareLinks()">üì§ Share</button>
  <button class="tool-btn btn-send-txt" onclick="sendRaw()">üì§ Send</button>
  <button class="tool-btn btn-send-enc" onclick="sendEncrypted()">üîê Enc</button>
  <button class="tool-btn btn-print" onclick="saveAsPDF()">üñ®Ô∏è Save as PDF</button>
</div>

<div class="workspace">
  <div id="editor" contenteditable="true" spellcheck="false">Start typing here...</div>
  
  <div id="calc" class="panel">
    <div class="calc-container">
      <div class="calc-header">CryptoAura</div>
      <div class="calc-display" id="calc-display">0</div>
      <div class="calc-buttons">
        <button class="calc-btn memory" onclick="calcMR()">MR</button>
        <button class="calc-btn memory" onclick="calcMC()">MC</button>
        <button class="calc-btn gray" onclick="calcClear()">C</button>
        <button class="calc-btn gray" onclick="calcClearEntry()">CE</button>
        <button class="calc-btn gray" onclick="calcInput('7')">7</button>
        <button class="calc-btn gray" onclick="calcInput('8')">8</button>
        <button class="calc-btn gray" onclick="calcInput('9')">9</button>
        <button class="calc-btn orange" onclick="calcInput('/')">/</button>
        <button class="calc-btn gray" onclick="calcInput('4')">4</button>
        <button class="calc-btn gray" onclick="calcInput('5')">5</button>
        <button class="calc-btn gray" onclick="calcInput('6')">6</button>
        <button class="calc-btn orange" onclick="calcInput('*')">*</button>
        <button class="calc-btn gray" onclick="calcInput('1')">1</button>
        <button class="calc-btn gray" onclick="calcInput('2')">2</button>
        <button class="calc-btn gray" onclick="calcInput('3')">3</button>
        <button class="calc-btn orange" onclick="calcInput('-')">-</button>
        <button class="calc-btn gray" onclick="calcInput('0')">0</button>
        <button class="calc-btn gray" onclick="calcInput('.')">.</button>
        <button class="calc-btn green" onclick="calcInput('Math.sqrt(')">‚àö</button>
        <button class="calc-btn orange" onclick="calcInput('+')">+</button>
        <button class="calc-btn memory" onclick="calcMPlus()">M+</button>
        <button class="calc-btn gray" onclick="calcInput('%')">%</button>
        <button class="calc-btn green" onclick="calcEquals()">=</button>
        <button class="calc-btn" style="background:#e74c3c;" onclick="calcBackspace()">‚å´</button>
      </div>
    </div>
  </div>
  
  <div id="currency" class="panel">
    <div class="currency-converter">
      <div class="currency-header">üí± Live Forex</div>
      <div class="currency-input-group">
        <input type="number" id="fromAmount" value="1" oninput="convertFrom()" class="currency-input-field">
        <select id="fromCurrency" onchange="convertFrom()" class="currency-select">
          <optgroup label="Crypto">
            <option value="BTC">BTC</option>
            <option value="ETH">ETH</option>
            <option value="SOL">SOL</option>
            <option value="XRP">XRP</option>
            <option value="DOGE">DOGE</option>
            <option value="ADA">ADA</option>
            <option value="USDT">USDT</option>
          </optgroup>
          <optgroup label="Fiat">
            <option value="USD">USD</option>
            <option value="EUR">EUR</option>
            <option value="RUB">RUB</option>
            <option value="CNY">CNY</option>
            <option value="GEL">GEL</option>
            <option value="JPY">JPY</option>
            <option value="ILS">ILS</option>
            <option value="SEK">SEK</option>
            <option value="NOK">NOK</option>
            <option value="DKK">DKK</option>
            <option value="AUD">AUD</option>
            <option value="ARS">ARS</option>
          </optgroup>
        </select>
      </div>
      <div class="currency-swap" onclick="swapCurrencies()">‚Üî</div>
      <div class="currency-input-group">
        <input type="number" id="toAmount" value="" oninput="convertTo()" class="currency-input-field">
        <select id="toCurrency" onchange="convertTo()" class="currency-select">
          <!-- same options -->
        </select>
      </div>
      <div class="currency-result" id="result">‚Äî</div>
      <div class="currency-rate" id="rate">‚Äî</div>
      <div class="currency-info" id="rate-info">Loading rates...</div>
    </div>
  </div>
  
  <div id="qr" class="panel">
    <div class="qr-output">
      <h3>üì± QR Code</h3>
      <div id="qrcode"></div>
      <p>Scan to share your document</p>
    </div>
  </div>
  
  <div id="share" class="panel">
    <div class="share-links" id="share-links">
      <h3>üì§ Share</h3>
      <div id="share-buttons"></div>
    </div>
  </div>
</div>

<!-- –ü–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π Excel -->
<div id="excel-full">
  <div class="toolbar">
    <button class="close-btn" onclick="hideExcelFull()">‚úñ Close</button>
    <button onclick="addRow()">+ Row</button>
    <button onclick="clearSheet()">Clear</button>
    <button onclick="importExcel()">Import XLSX</button>
    <button onclick="exportExcel()">Export XLSX</button>
    <button onclick="printExcel()">üñ®Ô∏è Print</button>
    <div class="lang-btn" onclick="toggleLangMenu()">üåê Language</div>
    <div class="lang-menu" id="lang-menu">
      <a href="#" onclick="setLanguage('EN')">EN</a>
      <a href="#" onclick="setLanguage('RU')">RU</a>
      <a href="#" onclick="setLanguage('ES')">ES</a>
      <a href="#" onclick="setLanguage('FR')">FR</a>
      <a href="#" onclick="setLanguage('ZH')">‰∏≠Êñá</a>
      <a href="#" onclick="setLanguage('JA')">Êó•Êú¨Ë™û</a>
      <a href="#" onclick="setLanguage('HE')">◊¢◊ë◊®◊ô◊™</a>
      <a href="#" onclick="setLanguage('AR')">ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</a>
      <a href="#" onclick="setLanguage('DE')">DE</a>
      <a href="#" onclick="setLanguage('PT')">PT</a>
    </div>
  </div>
  <div id="handsontable-container"></div>
</div>

<div class="footer">AURASYSTEM ‚Ä¢ Full control</div>

<script>
  let hotInstance = null;
  let currentLang = 'EN';

  // === –ü–ï–†–ï–í–û–î–´ ===
  const translations = {
    EN: {
      'Add Row': '+ Row',
      'Clear': 'Clear',
      'Import XLSX': 'Import XLSX',
      'Export XLSX': 'Export XLSX',
      'Print': 'Print',
      'Language': 'Language'
    },
    RU: {
      'Add Row': '+ –°—Ç—Ä–æ–∫–∞',
      'Clear': '–û—á–∏—Å—Ç–∏—Ç—å',
      'Import XLSX': '–ò–º–ø–æ—Ä—Ç XLSX',
      'Export XLSX': '–≠–∫—Å–ø–æ—Ä—Ç XLSX',
      'Print': '–ü–µ—á–∞—Ç—å',
      'Language': '–Ø–∑—ã–∫'
    },
    ES: {
      'Add Row': '+ Fila',
      'Clear': 'Limpiar',
      'Import XLSX': 'Importar XLSX',
      'Export XLSX': 'Exportar XLSX',
      'Print': 'Imprimir',
      'Language': 'Idioma'
    },
    FR: {
      'Add Row': '+ Ligne',
      'Clear': 'Effacer',
      'Import XLSX': 'Importer XLSX',
      'Export XLSX': 'Exporter XLSX',
      'Print': 'Imprimer',
      'Language': 'Langue'
    },
    ZH: {
      'Add Row': '+ Ë°å',
      'Clear': 'Ê∏ÖÈô§',
      'Import XLSX': 'ÂØºÂÖ• XLSX',
      'Export XLSX': 'ÂØºÂá∫ XLSX',
      'Print': 'ÊâìÂç∞',
      'Language': 'ËØ≠Ë®Ä'
    },
    JA: {
      'Add Row': '+ Ë°å',
      'Clear': '„ÇØ„É™„Ç¢',
      'Import XLSX': 'XLSX„Çí„Ç§„É≥„Éù„Éº„Éà',
      'Export XLSX': 'XLSX„Çí„Ç®„ÇØ„Çπ„Éù„Éº„Éà',
      'Print': 'Âç∞Âà∑',
      'Language': 'Ë®ÄË™û'
    },
    HE: {
      'Add Row': '+ ◊©◊ï◊®◊î',
      'Clear': '◊†◊ß◊î',
      'Import XLSX': '◊ô◊ô◊ë◊ï◊ê XLSX',
      'Export XLSX': '◊ô◊ô◊¶◊ï◊ê XLSX',
      'Print': '◊î◊ì◊§◊°◊î',
      'Language': '◊©◊§◊î'
    },
    AR: {
      'Add Row': '+ ÿµŸÅ',
      'Clear': 'ŸÖÿ≥ÿ≠',
      'Import XLSX': 'ÿßÿ≥ÿ™Ÿäÿ±ÿßÿØ XLSX',
      'Export XLSX': 'ÿ™ÿµÿØŸäÿ± XLSX',
      'Print': 'ÿ∑ÿ®ÿßÿπÿ©',
      'Language': 'ÿßŸÑŸÑÿ∫ÿ©'
    },
    DE: {
      'Add Row': '+ Zeile',
      'Clear': 'L√∂schen',
      'Import XLSX': 'XLSX importieren',
      'Export XLSX': 'XLSX exportieren',
      'Print': 'Drucken',
      'Language': 'Sprache'
    },
    PT: {
      'Add Row': '+ Linha',
      'Clear': 'Limpar',
      'Import XLSX': 'Importar XLSX',
      'Export XLSX': 'Exportar XLSX',
      'Print': 'Imprimir',
      'Language': 'Idioma'
    }
  };

  function translate(key) {
    return translations[currentLang][key] || key;
  }

  function setLanguage(lang) {
    currentLang = lang;
    updateToolbarTexts();
    if (hotInstance) {
      hotInstance.updateSettings({
        language: lang.toLowerCase()
      });
    }
    toggleLangMenu(false);
  }

  function toggleLangMenu(show) {
    const menu = document.getElementById('lang-menu');
    if (show === undefined) {
      menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
    } else {
      menu.style.display = show ? 'block' : 'none';
    }
  }

  function updateToolbarTexts() {
    const buttons = [
      { selector: '.toolbar button:nth-child(2)', key: 'Add Row' },
      { selector: '.toolbar button:nth-child(3)', key: 'Clear' },
      { selector: '.toolbar button:nth-child(4)', key: 'Import XLSX' },
      { selector: '.toolbar button:nth-child(5)', key: 'Export XLSX' },
      { selector: '.toolbar button:nth-child(6)', key: 'Print' },
      { selector: '.lang-btn', key: 'Language' }
    ];
    buttons.forEach(btn => {
      const el = document.querySelector(btn.selector);
      if (el) {
        el.textContent = translate(btn.key);
      }
    });
  }

  // === –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø EXCEL (Handsontable) ===
  function initExcel() {
    if (hotInstance) return;
    const data = loadTableData();

    hotInstance = new Handsontable(document.getElementById('handsontable-container'), {
       data,
      formulas: {
        engine: formulajs,
      },
      rowHeaders: true,
      colHeaders: true,
      contextMenu: true,
      filters: true,
      dropdownMenu: true,
      height: '100%',
      width: '100%',
      manualRowResize: true,
      manualColumnResize: true,
      language: currentLang.toLowerCase(),
      licenseKey: 'non-commercial-and-evaluation'
    });

    // –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
    hotInstance.addHook('afterChange', function() {
      saveTableData();
    });
  }

  function loadTableData() {
    const saved = localStorage.getItem('aura_excel');
    if (saved) {
      return JSON.parse(saved);
    }
    return Array(20).fill().map(() => Array(10).fill(''));
  }

  function saveTableData() {
    if (!hotInstance) return;
    const data = hotInstance.getData();
    localStorage.setItem('aura_excel', JSON.stringify(data));
  }

  // === –§–£–ù–ö–¶–ò–ò EXCEL ===
  function addRow() {
    if (hotInstance) {
      const rowCount = hotInstance.countRows();
      hotInstance.alter('insert_row', rowCount);
    }
  }

  function clearSheet() {
    if (hotInstance) {
      const empty = Array(20).fill().map(() => Array(10).fill(''));
      hotInstance.loadData(empty);
      saveTableData();
    }
  }

  function importExcel() {
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = '.xlsx,.xls';
    input.onchange = function(e) {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = function(e) {
        const data = new Uint8Array(e.target.result);
        const workbook = XLSX.read(data, { type: 'array' });
        const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
        const jsonData = XLSX.utils.sheet_to_json(firstSheet, { header: 1, defval: '' });
        if (hotInstance) {
          hotInstance.loadData(jsonData);
          saveTableData();
        }
      };
      reader.readAsArrayBuffer(file);
    };
    input.click();
  }

  function exportExcel() {
    if (!hotInstance) return;
    const data = hotInstance.getData();
    const ws = XLSX.utils.aoa_to_sheet(data);
    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws, "Sheet1");
    XLSX.writeFile(wb, 'aurasystem_spreadsheet.xlsx');
  }

  function printExcel() {
    window.print();
  }

  // === EXCEL FULL SCREEN ===
  function showExcelFull() {
    document.body.style.overflow = 'hidden';
    document.getElementById('excel-full').style.display = 'block';
    if (!hotInstance) {
      initExcel();
    }
    updateToolbarTexts();
  }

  function hideExcelFull() {
    document.body.style.overflow = 'auto';
    document.getElementById('excel-full').style.display = 'none';
  }

  // === –ü–ê–ù–ï–õ–ò ===
  function showPanel(id) {
    document.querySelectorAll('.panel').forEach(p => p.style.display = 'none');
    const panel = document.getElementById(id);
    if (!panel) return;
    panel.style.display = 'block';

    if (id === 'qr') {
      generateQR();
    } else if (id === 'share') {
      showShareLinks();
    }
  }

  // === –ö–ê–õ–¨–ö–£–õ–Ø–¢–û–†, –í–ê–õ–Æ–¢–´, QR, SHARE ‚Äî –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π ===
  let calcMemory = 0;
  let calcExpression = '';

  function calcInput(value) {
    if (value === 'Math.sqrt(') {
      calcExpression += 'Math.sqrt(';
    } else {
      calcExpression += value;
    }
    updateCalcDisplay();
  }

  function calcEquals() {
    try {
      let expr = calcExpression.replace(/(\d+)%/g, '($1/100)');
      let result = eval(expr);
      calcExpression = String(result);
    } catch (e) {
      calcExpression = 'Error';
    }
    updateCalcDisplay();
  }

  function calcClear() {
    calcExpression = '';
    updateCalcDisplay();
  }

  function calcClearEntry() {
    if (calcExpression.length > 0) {
      calcExpression = calcExpression.slice(0, -1);
    }
    updateCalcDisplay();
  }

  function calcBackspace() {
    calcClearEntry();
  }

  function calcMPlus() {
    try {
      calcMemory += parseFloat(eval(calcExpression || '0'));
    } catch (e) {}
  }

  function calcMR() {
    calcExpression = String(calcMemory);
    updateCalcDisplay();
  }

  function calcMC() {
    calcMemory = 0;
  }

  function updateCalcDisplay() {
    const display = document.getElementById('calc-display');
    if (!display) return;
    if (calcExpression === '') {
      display.textContent = '0';
    } else if (calcExpression.length > 15) {
      display.textContent = calcExpression.slice(0, 15) + '...';
    } else {
      display.textContent = calcExpression;
    }
  }

  // === –í–ê–õ–Æ–¢–´ ===
  let rates = null;
  const STATIC_RATES_USD = {
    USD: 1, EUR: 0.93, RUB: 93.5, CNY: 7.25, GEL: 2.70, JPY: 155.0,
    ILS: 3.70, SEK: 10.50, NOK: 10.80, DKK: 6.90, AUD: 1.52, ARS: 950.0,
    BTC: 1/92410, ETH: 1/2870, SOL: 1/172, XRP: 1/0.58,
    DOGE: 1/0.172, ADA: 1/0.45, USDT: 1/1.0001
  };
  let isConverting = false;

  async function loadRates() {
    if (rates) return;
    try {
      const res = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin,ethereum,solana,ripple,dogecoin,cardano,tether&vs_currencies=usd,eur,rub,cny,gel,jpy,ils,sek,nok,dkk,aud,ars');
      const data = await res.json();
      rates = {
        BTC: { usd: data.bitcoin.usd, eur: data.bitcoin.eur, rub: data.bitcoin.rub },
        ETH: { usd: data.ethereum.usd, eur: data.ethereum.eur, rub: data.ethereum.rub },
      };
      document.getElementById('rate-info').textContent = '‚úÖ Online rates';
      convertFrom();
    } catch (e) {
      rates = null;
      document.getElementById('rate-info').textContent = '‚ö†Ô∏è Offline (static rates)';
      convertFrom();
    }
  }

  function getUSDPrice(currency, amount = 1) {
    if (currency === 'USD') return amount;
    if (rates) {
      const id = currency.toLowerCase();
      if (rates[id]) {
        return amount * rates[id].usd;
      }
    }
    return amount / STATIC_RATES_USD[currency];
  }

  function convertFrom() {
    if (isConverting) return;
    isConverting = true;
    const from = document.getElementById('fromCurrency').value;
    const to = document.getElementById('toCurrency').value;
    const fromAmount = parseFloat(document.getElementById('fromAmount').value) || 0;
    
    if (from === to) {
      const v = fromAmount;
      document.getElementById('toAmount').value = v;
      document.getElementById('result').textContent = `${fromAmount} ${from} = ${v} ${to}`;
      document.getElementById('rate').textContent = '';
    } else {
      const usd = getUSDPrice(from, fromAmount);
      const toAmount = usd / getUSDPrice(to, 1);
      document.getElementById('toAmount').value = toAmount.toFixed(6);
      document.getElementById('result').textContent = `${fromAmount} ${from} = ${toAmount.toFixed(6)} ${to}`;
      document.getElementById('rate').textContent = `1 ${from} = ${(toAmount / fromAmount).toFixed(6)} ${to}`;
    }
    isConverting = false;
  }

  function convertTo() {
    if (isConverting) return;
    isConverting = true;
    const from = document.getElementById('fromCurrency').value;
    const to = document.getElementById('toCurrency').value;
    const toAmount = parseFloat(document.getElementById('toAmount').value) || 0;
    
    if (from === to) {
      document.getElementById('fromAmount').value = toAmount;
      document.getElementById('result').textContent = `${toAmount} ${to} = ${toAmount} ${from}`;
      document.getElementById('rate').textContent = '';
    } else {
      const usd = getUSDPrice(to, toAmount);
      const fromAmount = usd / getUSDPrice(from, 1);
      document.getElementById('fromAmount').value = fromAmount.toFixed(6);
      document.getElementById('result').textContent = `${fromAmount.toFixed(6)} ${from} = ${toAmount} ${to}`;
      document.getElementById('rate').textContent = `1 ${to} = ${(fromAmount / toAmount).toFixed(6)} ${from}`;
    }
    isConverting = false;
  }

  function swapCurrencies() {
    const fromSel = document.getElementById('fromCurrency');
    const toSel = document.getElementById('toCurrency');
    const fromVal = fromSel.value;
    const fromAmt = document.getElementById('fromAmount').value;
    
    fromSel.value = toSel.value;
    toSel.value = fromVal;
    
    document.getElementById('fromAmount').value = document.getElementById('toAmount').value;
    document.getElementById('toAmount').value = fromAmt;
    
    convertFrom();
  }

  function generateQR() {
    const text = document.getElementById('editor').innerText.trim() || 'Document from Aura Office';
    const qrContainer = document.getElementById('qrcode');
    if (!qrContainer) return;
    qrContainer.innerHTML = '';
    const qr = new QRious({
      element: document.createElement('canvas'),
      value: text,
      size: 200
    });
    qrContainer.appendChild(qr.element);
  }

  function showShareLinks() {
    const url = 'https://aurasystem.space/office/';
    const text = 'Document from Aura Office';
    const buttons = `
      <a href="https://x.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent(url)}" target="_blank" class="x">ùïè</a>
      <a href="https://t.me/share/url?url=${encodeURIComponent(url)}&text=${encodeURIComponent(text)}" target="_blank" class="telegram">Telegram</a>
      <a href="https://wa.me/?text=${encodeURIComponent(text + ' ' + url)}" target="_blank" class="whatsapp">WhatsApp</a>
      <a href="mailto:?subject=${encodeURIComponent(text)}&body=${encodeURIComponent(url)}" class="email">Email</a>
    `;
    const shareButtons = document.getElementById('share-buttons');
    if (shareButtons) {
      shareButtons.innerHTML = buttons;
    }
  }

  function inviteCollab() {
    const id = 'AURA-' + Math.random().toString(36).substr(2, 5).toUpperCase();
    localStorage.setItem('doc_' + id, document.getElementById('editor').innerText);
    const url = 'https://aurasystem.space/office/?doc=' + id;
    prompt('Send this link to a friend:', url);
  }

  function sendRaw() { alert('üì§ Sent'); }
  function sendEncrypted() { alert('üîê Encrypted'); }

  function saveAsPDF() {
    const element = document.getElementById('editor');
    if (!element) return;
    const opt = {
      margin: 10,
      filename: 'aurasystem_document.pdf',
      image: { type: 'jpeg', quality: 0.98 },
      html2canvas: { scale: 2 },
      jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
    };
    html2pdf().set(opt).from(element).save();
  }

  window.onload = () => {
    document.getElementById('editor').focus();
    loadRates();
  };
</script>

</body>
</html>
